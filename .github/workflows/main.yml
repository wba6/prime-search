name: Convert Markdown to PDF and Commit

# Define the permissions for GITHUB_TOKEN
permissions:
  contents: write  # Grants read and write access to repository contents

on:
  push:
    branches:
      - main
    paths:
      - 'Deep-Dive.md'
      - '.github/workflows/convert-markdown-to-pdf.yml'

permissions:
  contents: write  # Grants write access to the GITHUB_TOKEN

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Ensures full history is fetched

      - name: Install Pandoc and LaTeX
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive texlive-xetex texlive-latex-extra

      - name: Convert Markdown to PDF
        run: |
          mkdir -p pdf
          pandoc Deep-Dive.md -o pdf/Deep-Dive.pdf

      - name: Commit and Push PDF
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Check if pdf/Deep-Dive.pdf has changes
          if git diff --exit-code --quiet pdf/Deep-Dive.pdf; then
            echo "No changes to commit"
          else
            # Configure Git
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"

            # Add and commit the PDF
            git add pdf/Deep-Dive.pdf
            git commit -m "Update Deep-Dive.pdf"

            # Set the remote URL with GITHUB_TOKEN for authentication
            git remote set-url origin https://${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git

            # Push the changes
            git push origin main
          fi
